
stages:
  - test
  - build
  - deploy

include:
  - template: Security/SAST.gitlab-ci.yml

azure-auth:
  image: mcr.microsoft.com/azure-cli:latest
  stage: test
  variables:
    AZURE_CLIENT_ID: $AAD_GITLAB_CI_CLIENT_ID
    AZURE_TENANT_ID: $AZURE_TENANT_ID_HEGERDES
  id_tokens:
    GITLAB_OIDC_TOKEN:
      aud: https://gitlab.com
  script:
    - az login --service-principal -u $AZURE_CLIENT_ID -t $AZURE_TENANT_ID --federated-token $GITLAB_OIDC_TOKEN
    - az account show

sast:
  stage: test
