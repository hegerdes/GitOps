---
# Source: telepresence-oss/templates/trafficManagerRbac/service-account.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
---
# Source: telepresence-oss/templates/agentInjectorWebhook.yaml
apiVersion: v1
kind: Secret
metadata:
  name: mutator-webhook-tls
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKRENDQWd5Z0F3SUJBZ0lSQU0rRlQ2UE1jQlhRaDgvRTd4K1IzNTB3RFFZSktvWklodmNOQVFFTEJRQXcKSERFYU1CZ0dBMVVFQXhNUllXZGxiblF0YVc1cVpXTjBiM0l0WTJFd0hoY05Nall3TVRJeE1qRXhNRE15V2hjTgpNamN3TVRJeE1qRXhNRE15V2pBY01Sb3dHQVlEVlFRREV4RmhaMlZ1ZEMxcGJtcGxZM1J2Y2kxallUQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFOYnlOeWo4MDQ5eTFSQzBHSXNEMTFaZjAwSGcKQUt0SG05bldjS3RvaWdBTUt6dmgvVHlCamV6bnVxSzg2YWcwZWRJNFZpcGlyZWtwVVFuU2J4eXdFbEFNQ2JzaQpjemtiZldEd1o4Qnl2Mm00czlPVVM5VHhvMUlSQ0FrZHQ5UGRLWlB5YTZiUUVWM210bEVpSkwxcFEwQUlaUWM4ClBTWGxrcnBnbW9HWUNxVUVvZzNiVUt0K3dSRTVYYm9HZ3BsaFZCYUZRV0FTWGVHYjlRem1JeUdEcFVYem9GM2QKbjU1MlNBbHlBcWpFeXV0ZzYrNzhNQ1lXd3Zuc2YvaXIwUjBhdmNITXhZUmRVSGdzNkp0YlM5OE1jL1QrQ3JOQwp3czJ4V2dMTXF5WUhYQWRkM3JNYnZObnpXQVZSdVYvZzZMZ2dOTmJiazdKYkUxL1R1VGxQVGpMNUlpa0NBd0VBCkFhTmhNRjh3RGdZRFZSMFBBUUgvQkFRREFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRV0JCU2RzTitIbGs5ZlMwSXUwaUpXWWtmZwo1dVlPM0RBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQUlRWEdwS1NKRnUvUk9hU0t6aXFITEswVVhhcDFuMHcvClZaMkpzandCT3dBYmh0SW5DRVJRZWp1MjNGZkdGMG1qWGhsd2VGR21zUy9PenJ3cnVSeFhBSXhwcys4U0pPZnAKZngwdEFmOWtZQW5JOE5haXNhbnd3dlVDQ0ZNZkdPTDNRMVdtNXVVN1lkWHhiN1VUOHRzaEVOQ3ZOVG55ajFuaApwMlhqTStHdGZMNWNYdzYrU0d3L0FDYjRrdkZpS1JuVEs3R1p3TWF5bTJUcnpwaVYxcGtDMk8xY1NxMVZxSXF4Cm5UZWZyQmp6WDBRMVpranZXejFxTHdXUTAvMTJFVUt4YWxsYjVjbjVXRzR0V0Q1cjI2S2VvMWhJS1hmZjBpcjUKVFNwVlljRVQzWi8rOUhiOVl3NWZSQWpqOXpTaXdkRy9lNDExOEE1Yy9sdW45WnpGQmFOeHpBPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURZVENDQWttZ0F3SUJBZ0lSQU5XWE9tV1lrUGc0R1F6Y2dRcVVERTB3RFFZSktvWklodmNOQVFFTEJRQXcKSERFYU1CZ0dBMVVFQXhNUllXZGxiblF0YVc1cVpXTjBiM0l0WTJFd0hoY05Nall3TVRJeE1qRXhNRE15V2hjTgpNamN3TVRJeE1qRXhNRE15V2pBWk1SY3dGUVlEVlFRREV3NWhaMlZ1ZEMxcGJtcGxZM1J2Y2pDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU53elorWkZCTjRsNDNGWFNHTjlYVkpIMi9yVytSNHMKbFlRa0EvYVBmdjVMelZLdzRlajFCekJGU3BQVC9OMHduZ3U0bnVuMXpKTFc2SWpNdnBRejBVV00yRCtzMTZVagpSdHhFYUZDNDNCWkYvU0ovWnJnbkFSSVFLb3E5MlZaeFpUOTB0VUdOYWx5ZFo0bFBvamFCTnJoQWJVTDFwOFVJCityclZDS2lVckZOcDljRFphZDZES0pIVGw0VDdNV3JCalNVWTRiYS9GbW9wZ05iVW5MTWd0RHVYb1drekxUTkkKemtObURxNzZ1VGUwV25YTGVOZFlTcVZRTWZUbDNqbWJ5SDlwTVl6cVlsaytBQ3YwRW1wRnU0bVRFT0o4THdPNgpBOEpxTDVHTlFlOTNQUXBVTmVFeXZSRHdTWXJ4U05LeXJVdkVxeGtXaVZnRXczdUtOQk0wYUw4Q0F3RUFBYU9CCm9EQ0JuVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0VHQ0NzR0FRVUYKQndNQ01Bd0dBMVVkRXdFQi93UUNNQUF3SHdZRFZSMGpCQmd3Rm9BVW5iRGZoNVpQWDB0Q0x0SWlWbUpINE9ibQpEdHd3UFFZRFZSMFJCRFl3TklJV1lXZGxiblF0YVc1cVpXTjBiM0l1WkdWbVlYVnNkSUlhWVdkbGJuUXRhVzVxClpXTjBiM0l1WkdWbVlYVnNkQzV6ZG1Nd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFNUUp3cThmK29NYW43c2IKTFFFVEFHWjhjMmZHZThleFVSMlNBRjRLQXR4RXVmVHg2ZkRRNmg5RVErZ3Z2ZzJWSlZrUjRmcXpMV1JKTWV3dwpQRk84NE5QcDB5TG82cmVPOXJ1MDhQYXkyRk1Zc2c2SnlBcmJ3Q3NFRXBMdTlCUzhGY1FXdHEzanNZcStvOEoxCmdQa1Y2eEduZmhKZTRMdjVVQzNIazBUalVxYW5MUmhpN2Y5U3lPV1Jub29keHRyOVlwQ3U2YW5RdkNGbzd2ekMKVlM1ZW5xdllwV3R3a25DRmtFK0VaSkU4NXFDNWJOY2xFMmtiMHJEK2J0WEt1NXYxVW1tZ0tKdE5aaEswSmk1QwpMOUZURWtCSXpWTmdHODlYeHlESGRWY0F5MVBHR1BmZDZTVkRSZzc4ZGJock5tazNMMGhyTlUyZmxZMVBXenVXCkJjc0lDams9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBM0RObjVrVUUzaVhqY1ZkSVkzMWRVa2ZiK3RiNUhpeVZoQ1FEOW85Ky9rdk5VckRoCjZQVUhNRVZLazlQODNUQ2VDN2llNmZYTWt0Ym9pTXkrbERQUlJZellQNnpYcFNORzNFUm9VTGpjRmtYOUluOW0KdUNjQkVoQXFpcjNaVm5GbFAzUzFRWTFxWEoxbmlVK2lOb0UydUVCdFF2V254UWo2dXRVSXFKU3NVMm4xd05scAozb01va2RPWGhQc3hhc0dOSlJqaHRyOFdhaW1BMXRTY3N5QzBPNWVoYVRNdE0wak9RMllPcnZxNU43UmFkY3Q0CjExaEtwVkF4OU9YZU9adklmMmt4ak9waVdUNEFLL1FTYWtXN2laTVE0bnd2QTdvRHdtb3ZrWTFCNzNjOUNsUTEKNFRLOUVQQkppdkZJMHJLdFM4U3JHUmFKV0FURGU0bzBFelJvdndJREFRQUJBb0lCQUFXUzdPRk1ZYkZMdlV1OApwTTZWUFlubTIzNm9aaVZuUVdDUzdBT1BXWVpDb2trOFBETXM0S2hmV0taVXhnOXdHSzN3bkFxRTNwTytUb0hsCjJiQlhPaDBwNjBYUld3bG5GekxFTGR5YkdkdGdGRXpSNnlxb1QvYmtTZDVUVnQ1aktwS0tnR3NDUGUwalRjOFoKbUdqSE1WcWFQRHJlZTIzRVZUaTNGdjBFNnE0d3Z0U1J0MlJjZU9xSUc2eWZoM2ozMkhuY1JDZitmeHZ5WW5MMQo3elhjS053emZGRkd6V2IzdEFBUkFWUkRuZS9ibmtORVhGMHhPNFFuejVFeDFGdzVHOW9vTjlJaXZCeUdGblZuCmZDMjJsQ29kZHJYTEk5aVNQWDErT0ptbTM1azBFOExWeHhodno3OHVjUGVaaGNrTlM0QUlER0J5VCtIT0s0YXQKQ1ZicmtpRUNnWUVBNlZBcEZVYk0yZjlQMzVrdi9CZXlXbWRNSnFpVHM4SzZNNENOcUNyajN2WWlFS2cyaytpZQpzT1U2VmRlUWV3SEVuM010STNFeEI4ek91VVBndEFOYzB0Z0J3N1h0OTk5RTM1eFpaS1M3YzlwUTlpellpd0tzCkFOVFZMVDBZcDhpMjBRWkR0eTlUQ2dvaG5VZVpLdGJnY0M1M0g2cEtBUGVxRUEyQ0xYd0Q3RDBDZ1lFQThaelgKZUpFd3FFVTlWdERCejZWaVdOODVJK2l1NEtiSzhpVUs2UUFnRDNHNXRyTnJWWWZ1cXJjN0dsYUIrZ1cyNXl3dwpCaEUzNW5RVDdlWVlXU0xzMmhLWFpOVzZPa2VZSUhtSkVaL3FDVnQ0ZGZrMkxFeW9BbVNpbUZnOWc0d3lseVV6ClRIcG9DNU1BQi9Zc0htak9zbVZON3pCSmlpczlzSlZUYy9uNXpLc0NnWUJhdEs1ME5pVllMMWxYUGRBWSt3RjkKQWlIcCthb0t2ZzcwRE91RjBMN3NwTlpUa1lJK2VMYVJZVjBQbUpIME1Kakh3Tmh3cWdYODJWUVpWTmxjUXQ1bwpuay81VFphcHdtU2Rac1NlU3lrUmZuUHhjVGZ5dTJReG9vMEtYSEZrY2JVWmlJejAvL0lSdWlTZGFBT1ZVeHJJCm9sZnZ1SjJ5eUphV1RSb3FJc2ZIcFFLQmdRQ1poKzNQK29ydDBwbkl5Znp1WXd5Y3ByUmJvaWRHTUJiMFNoK2wKc2VPdGpMblRaQzNIZXdwcFJ1ZnlzNWdDZFpFbFV3bnRRUkhCaW0rRGs5eFRBQU44QzZaU2VCSFBxT0Q5ZWQxawo2clpBWGZTdEdzQ1c0OXM3TWhHME54Wlh1a1lIajZjS2FSb21pTEhUWFZYcHVQWG5uTUlxUlFmbUdkWW9tS3NnCkhtL2k0d0tCZ1FESzkrNmVCbllNRkk0SEIzZXlDVnRuY05Na1ltYk5kYk5kVHpaSTBSWTJYN004MGFvdDdPdlkKWmwxMVpJKzdPNVd5VG1XMEMzSHVEYUlkczd4N20vdUl5ZjhLWWJoeTFaU1NwMFBiRTVoY1RWblpCdUc1b0QvdwpBai9sdTF5R3I4UkF5Y0RUL3pBTHJ2d0EzbHhEVjlkTDBMRXJDc2hpTS8zYzQwMFFrWVJkeGc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
# Source: telepresence-oss/templates/trafficManager-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
data:
  client.yaml: |
    dns:
      excludeSuffixes:
      - .com
      - .io
      - .net
      - .org
      - .ru
  namespace-selector.yaml: |
    matchExpressions:
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
      - kube-node-lease
  agent-state.yaml: |
    AgentStates: {}
---
# Source: telepresence-oss/templates/trafficManagerRbac/cluster-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: traffic-manager-default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
rules:
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - update 
- apiGroups:
  - ""
  resources:
  - nodes
  - services
  - namespaces
  - pods
  verbs:
  - list
  - get
  - watch
- apiGroups:
  - ""
  resources:
  - pods/eviction
  verbs:
  - create
- apiGroups:
  - ""
  resources:
  - pods/log
  verbs:
  - get
- apiGroups:
  - "apps"
  resources:
  - deployments
  - replicasets
  - statefulsets
  verbs:
  - get
  - list
  - watch
  - patch
- apiGroups:
    - "events.k8s.io"
  resources:
    - events
  verbs:
    - get
    - watch
- apiGroups:
    - "networking.k8s.io"
  resources:
    - servicecidrs
  verbs:
    - list
---
# Source: telepresence-oss/templates/trafficManagerRbac/cluster-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: traffic-manager-default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: traffic-manager-default
subjects:
- kind: ServiceAccount
  name: traffic-manager
  namespace: default
---
# Source: telepresence-oss/templates/trafficManagerRbac/namespace-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: traffic-manager
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
rules:
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - create
- apiGroups:
    - ""
  resources:
    - configmaps
  verbs:
    - get
    - list
    - watch
    - patch
  resourceNames:
    - traffic-manager
---
# Source: telepresence-oss/templates/trafficManagerRbac/webhook-secret.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: agent-injector-webhook-secret
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  resourceNames: [ mutator-webhook-tls ]
  verbs:
  - get
  - list
  - watch
---
# Source: telepresence-oss/templates/trafficManagerRbac/namespace-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: traffic-manager
subjects:
- kind: ServiceAccount
  name: traffic-manager
  namespace: default
---
# Source: telepresence-oss/templates/trafficManagerRbac/webhook-secret.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: agent-injector-webhook-secret
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: agent-injector-webhook-secret
subjects:
  - kind: ServiceAccount
    name: traffic-manager
    namespace: default
---
# Source: telepresence-oss/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
spec:
  type: ClusterIP
  clusterIP: None
  ports:
  - name: api
    port: 8081
    targetPort: api
  selector:
    app: traffic-manager
    telepresence: manager
---
# Source: telepresence-oss/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: agent-injector
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
spec:
  type: ClusterIP
  ports:
  - name: https
    port: 8443
    targetPort: https
  selector:
    app: traffic-manager
    telepresence: manager
---
# Source: telepresence-oss/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app: traffic-manager
      telepresence: manager
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1        # Allows creating one extra pod during the update
      maxUnavailable: 0  # Ensures no pods are terminated until new ones are ready
  template:
    metadata:
      labels:
        app: traffic-manager
        telepresence: manager
    spec:
      securityContext:
        null
      containers:
        - name: traffic-manager
          securityContext:
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 1000
          image: "ghcr.io/telepresenceio/tel2:2.25.2"
          imagePullPolicy: IfNotPresent
          env:
          - name: LOG_LEVEL
            value: info
          - name: REGISTRY
            value: "ghcr.io/telepresenceio"
          - name: SERVER_PORT
            value: "8081"
          - name: POD_CIDR_STRATEGY
            value: auto
          - name: MUTATOR_WEBHOOK_PORT
            value: "8443"
          - name: AGENT_INJECTOR_SECRET
            value: mutator-webhook-tls
          - name: GRPC_MAX_RECEIVE_SIZE
            value: 4Mi
          - name: CLIENT_CONNECTION_TTL
            value: 24h
          - name: ENABLED_WORKLOAD_KINDS
            value: >-
              Deployment
              StatefulSet
              ReplicaSet
          - name: AGENT_ARRIVAL_TIMEOUT
            value: "30s"
          - name: AGENT_INJECT_POLICY
            value: OnDemand
          - name: AGENT_INJECTOR_NAME
            value:  "agent-injector"
          - name: AGENT_PORT
            value: "9900"
          - name: AGENT_MOUNT_POLICIES
            value: '{"/tmp":"Local"}'
          - name: AGENT_INIT_CONTAINER_ENABLED
            value: "true"
          - name: AGENT_IMAGE_PULL_POLICY
            value: IfNotPresent
          - name: MAX_NAMESPACE_SPECIFIC_WATCHERS
            value: "10"
          - name: MANAGER_NAMESPACE
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
          - name: POD_IP
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: status.podIP
          - name: CLIENT_DNS_EXCLUDE_SUFFIXES
            value: ".com .io .net .org .ru"
          ports:
          - name: api
            containerPort: 8081
          - name: https
            containerPort: 8443
      serviceAccount: traffic-manager
      serviceAccountName: traffic-manager
---
# Source: telepresence-oss/templates/agentInjectorWebhook.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: agent-injector-webhook-default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKRENDQWd5Z0F3SUJBZ0lSQU0rRlQ2UE1jQlhRaDgvRTd4K1IzNTB3RFFZSktvWklodmNOQVFFTEJRQXcKSERFYU1CZ0dBMVVFQXhNUllXZGxiblF0YVc1cVpXTjBiM0l0WTJFd0hoY05Nall3TVRJeE1qRXhNRE15V2hjTgpNamN3TVRJeE1qRXhNRE15V2pBY01Sb3dHQVlEVlFRREV4RmhaMlZ1ZEMxcGJtcGxZM1J2Y2kxallUQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFOYnlOeWo4MDQ5eTFSQzBHSXNEMTFaZjAwSGcKQUt0SG05bldjS3RvaWdBTUt6dmgvVHlCamV6bnVxSzg2YWcwZWRJNFZpcGlyZWtwVVFuU2J4eXdFbEFNQ2JzaQpjemtiZldEd1o4Qnl2Mm00czlPVVM5VHhvMUlSQ0FrZHQ5UGRLWlB5YTZiUUVWM210bEVpSkwxcFEwQUlaUWM4ClBTWGxrcnBnbW9HWUNxVUVvZzNiVUt0K3dSRTVYYm9HZ3BsaFZCYUZRV0FTWGVHYjlRem1JeUdEcFVYem9GM2QKbjU1MlNBbHlBcWpFeXV0ZzYrNzhNQ1lXd3Zuc2YvaXIwUjBhdmNITXhZUmRVSGdzNkp0YlM5OE1jL1QrQ3JOQwp3czJ4V2dMTXF5WUhYQWRkM3JNYnZObnpXQVZSdVYvZzZMZ2dOTmJiazdKYkUxL1R1VGxQVGpMNUlpa0NBd0VBCkFhTmhNRjh3RGdZRFZSMFBBUUgvQkFRREFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRV0JCU2RzTitIbGs5ZlMwSXUwaUpXWWtmZwo1dVlPM0RBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQUlRWEdwS1NKRnUvUk9hU0t6aXFITEswVVhhcDFuMHcvClZaMkpzandCT3dBYmh0SW5DRVJRZWp1MjNGZkdGMG1qWGhsd2VGR21zUy9PenJ3cnVSeFhBSXhwcys4U0pPZnAKZngwdEFmOWtZQW5JOE5haXNhbnd3dlVDQ0ZNZkdPTDNRMVdtNXVVN1lkWHhiN1VUOHRzaEVOQ3ZOVG55ajFuaApwMlhqTStHdGZMNWNYdzYrU0d3L0FDYjRrdkZpS1JuVEs3R1p3TWF5bTJUcnpwaVYxcGtDMk8xY1NxMVZxSXF4Cm5UZWZyQmp6WDBRMVpranZXejFxTHdXUTAvMTJFVUt4YWxsYjVjbjVXRzR0V0Q1cjI2S2VvMWhJS1hmZjBpcjUKVFNwVlljRVQzWi8rOUhiOVl3NWZSQWpqOXpTaXdkRy9lNDExOEE1Yy9sdW45WnpGQmFOeHpBPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    service:
      name: agent-injector
      namespace: default
      path: /traffic-agent
      port: 8443
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    - DELETE
    resources:
    - pods
    scope: '*'
  failurePolicy: Ignore
  reinvocationPolicy: IfNeeded
  name: agent-injector-default.telepresence.io
  sideEffects: None
  timeoutSeconds: 5
  namespaceSelector:
    matchExpressions:
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
      - kube-node-lease
---
# Source: telepresence-oss/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "traffic-manager-test-connection"
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
    - name: wget
      image: "docker.io/busybox:latest"
      command: ['wget']
      args: ['traffic-manager:8081']
  restartPolicy: Never
---
# Source: telepresence-oss/templates/pre-delete-hook.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: uninstall-agents
  namespace: default
  labels:
    app.kubernetes.io/managed-by: "Helm"
    app.kubernetes.io/instance: "telepresence-traffic-manager"
    app.kubernetes.io/version: 2.25.2
    helm.sh/chart: "telepresence-oss-2.25.2"
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-weight": "-5"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  backoffLimit: 1
  template:
    metadata:
      name: uninstall-agents
      labels:
        app.kubernetes.io/managed-by: "Helm"
        app.kubernetes.io/instance: "telepresence-traffic-manager"
        helm.sh/chart: "telepresence-oss-2.25.2"
    spec:
      securityContext:
        null
      restartPolicy: Never
      containers:
        - name: uninstall-agents
          securityContext:
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 1000
          image: "docker.io/curlimages/curl:8.1.1"
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: secret-volume
              mountPath: /secret
          env:
            - name: CURL_CA_BUNDLE
              value: /secret/ca.crt
          resources:
            null
          command:
            - sh
            - -c
          args:
            - 'curl --fail --connect-timeout 5 --max-time 60 --request DELETE https://agent-injector.default:8443/uninstall || exit 0'
      volumes:
        - name: secret-volume
          secret:
            secretName: mutator-webhook-tls
