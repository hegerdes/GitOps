---
# Source: telepresence-oss/templates/trafficManagerRbac/service-account.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
---
# Source: telepresence-oss/templates/agentInjectorWebhook.yaml
apiVersion: v1
kind: Secret
metadata:
  name: mutator-webhook-tls
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKRENDQWd5Z0F3SUJBZ0lSQU0vdVFRWjlka2U4K3lSaHBRS3VEOHN3RFFZSktvWklodmNOQVFFTEJRQXcKSERFYU1CZ0dBMVVFQXhNUllXZGxiblF0YVc1cVpXTjBiM0l0WTJFd0hoY05Nall3TVRJME1UZzBOREExV2hjTgpNamN3TVRJME1UZzBOREExV2pBY01Sb3dHQVlEVlFRREV4RmhaMlZ1ZEMxcGJtcGxZM1J2Y2kxallUQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPRDhvcEl1SzQ5KzNjRkk3NWlHaExueGJGcmEKR3VhaENqaTgrdTBWenZzS052T3BlNDB5OGtxeEFORVdGYlFzTSswckoydGhDeXhxY0NQTHNYdmxyMStnSDJEVwpMVXIrVVlDM3JtcHJ4LzN6Snh2Yk1mSzdnTGN0U0RHeHJ4bHFmTEhJZjhSQzZqNVJtMkdydUhhNUVYVHFvQXdCCmNSVmc3ZGV6RDA3Z0M0c3FQcXZGcm9FeWw2MG1sTjQ3ZUdKN0ZlQ0hlVlhMd010R1dDOFZZZERSZElZZXFXdm4KSG5ybzFrUEVBK1VkNUp1YzVKSnVLMjZSOHd6UGs4UGtEQnRHb2tJUlFvRlhFYmVkSDdwUjZudHJyczNQS3FhVgp2aGxhT1k2anh2Z0ZOUzFsU0g0eHJEQ0ZUQ1FkYVRBaUxENWdFLzFlR2hrSXMvOUtFVEZYa2NjZDVoMENBd0VBCkFhTmhNRjh3RGdZRFZSMFBBUUgvQkFRREFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRV0JCVEdrZ1JIZVpvTCtYb0ZwNGZBVUpNMgpPeTd0SkRBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQWZ2VVkrOG5FRlQ0aHdPOCtnUjQ0bXBSdStGTDdObmlWCkM3dFMzanJRc3ByYWxiNkVRUXltcmE0YzllOGR5ZTJ0VVl4dHlNY3UydVdSZ0s0M1IxeG4wUlBCNG9QVUdMLzIKU1JOSk9uWWtzWU9FZzJpVHIxenFIK0h4b3ZwdXBwMlZFNnZOR1Y0S2I1K0Z5LzdnQkpIQlg0SFd1L1NLZm5mRAorcjBXNjhmaG9rcUVsNThqOUdDTzFEeG1ISjR3UHovdE1WK0lEcVFDNHNid3JRYXBCOUQydUwrRStWSElpbmJUCkZneFdqeEZmU2xuaHl0Y2MvT1EwYzRtdHFwQyt2YlNoaGJITlY5ZWl3WmVqYkl1bmllcjg0VXlNZkgycVl1SGgKVk5aM1hKcnRyRVdCM0FlbnlXb1NjaCtUclZKcHUyTjBsWncyRXZuSENabUN0YmhJbWRLTUV3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURZRENDQWtpZ0F3SUJBZ0lRUFV5VFVIenM1QlVreWtoZkVGZWVaREFOQmdrcWhraUc5dzBCQVFzRkFEQWMKTVJvd0dBWURWUVFERXhGaFoyVnVkQzFwYm1wbFkzUnZjaTFqWVRBZUZ3MHlOakF4TWpReE9EUTBNRFZhRncweQpOekF4TWpReE9EUTBNRFZhTUJreEZ6QVZCZ05WQkFNVERtRm5aVzUwTFdsdWFtVmpkRzl5TUlJQklqQU5CZ2txCmhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBNXdEeUNKYlU2TXFla3B6ekV3TnVFTFRQL2MwcG8wS3gKbEVyT2FLd05DdG1IZjZXb1RNcmVIUzQrWDF4SDgvOUVCbVBIb3RvbldaVnB6RUVhV0pTUStwbk51ejFjMDMvQgpHdkJCc1hWZnR2NllKVTB3MjBBdzNJbHhZREUvN0JWQWdIMW9UT0IyT3VJS1B0ZDNmdGVHNWFQcDJGcXFlSWltCmFzcVVuZnViV3BUSUpwdk8vNmN5WlpENkpuS0dXWGcxMTEyMW5WUkp2MmZVeFlkTGVPMGxHaldOQytkSXJ6UCsKRXlDbFVCbXlXck5VUFNrbXpxTkxnek5mUzhxWnFpZ1l0SFhyRFBZbVBFRmF2S0NJS3pzeUpnSWUwdkNPbFhkegovZXN4dGkzNFFnbU41S2dxZDhGQlFlTWtlUW0xTWsraGZDUThIc2hhN3cvSE5xQ09yOU12L1FJREFRQUJvNEdnCk1JR2RNQTRHQTFVZER3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JUR2tnUkhlWm9MK1hvRnA0ZkFVSk0yT3k3dApKREE5QmdOVkhSRUVOakEwZ2haaFoyVnVkQzFwYm1wbFkzUnZjaTVrWldaaGRXeDBnaHBoWjJWdWRDMXBibXBsClkzUnZjaTVrWldaaGRXeDBMbk4yWXpBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQVVnYW9SU29iZW4vV2xEc1AKTHhJUytvVEY4RWxxcE9KREZxd3plR0dmVzFzV2h0OHhVZUp5bzlJeGRTKzhkcE85bUtsZnpRb1RwQXp0RTRxcApxdFRnNHo5UW5HY0tNbHFYQi9hbktvVVZvSHFWVmhYNUtKSHFRMTRSYkxveldLaTkwZEV4ZStMOVVuSUtoUVZUCkJvdEdPT0wrUVo1c1Z2T2tRS2FpSWhQRUF2U3dCbkJtZVJnVzl5ZkoyNG5oaHhFK09vaFNqdGtVSnB1eHM0ak0KR2FUQXBqaWV0TkdPU0l4dGZUK0lyN1BwVVQrRTJMVnRqRXJsaFRzcGlxcjdyQ05VczIzbmRiT2RZRjU3V1JLUwp3SVkxZEF1cUxIb0ZNd25SdkhSK3VWRzJCRU0rU2F6azlLWGRGcFJzZVJhRUhxSlIrSmF2amZ1RG1BdFZtNjdlCnBqMW8ydz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBNXdEeUNKYlU2TXFla3B6ekV3TnVFTFRQL2MwcG8wS3hsRXJPYUt3TkN0bUhmNldvClRNcmVIUzQrWDF4SDgvOUVCbVBIb3RvbldaVnB6RUVhV0pTUStwbk51ejFjMDMvQkd2QkJzWFZmdHY2WUpVMHcKMjBBdzNJbHhZREUvN0JWQWdIMW9UT0IyT3VJS1B0ZDNmdGVHNWFQcDJGcXFlSWltYXNxVW5mdWJXcFRJSnB2TwovNmN5WlpENkpuS0dXWGcxMTEyMW5WUkp2MmZVeFlkTGVPMGxHaldOQytkSXJ6UCtFeUNsVUJteVdyTlVQU2ttCnpxTkxnek5mUzhxWnFpZ1l0SFhyRFBZbVBFRmF2S0NJS3pzeUpnSWUwdkNPbFhkei9lc3h0aTM0UWdtTjVLZ3EKZDhGQlFlTWtlUW0xTWsraGZDUThIc2hhN3cvSE5xQ09yOU12L1FJREFRQUJBb0lCQUFUa0Uvdk52Uk1kdG5iMQpERDk1anpNYTJrYlllUnAydWNoTVA0RUtBdHBaTkl3bHY0RzZ1akphSXVJYTA5VFh4dGdFeWxBSmVENVJFblQyClBEN1JESE1iTTdiVWE5cWkyejJTV3kyM20yVWJrRnRGS1FvOHI4YlNRU2N2MFJlUzgvTS9LZE5yaURmNGNRNUMKRDhxM2VQNGVqRCt6WEdYTXdqWHVIL0NWWGNWd2s5enhaZUkvQ2EwWXlsVitIQnZwTFVmenIxRHAxTGVKQlA1YwpCVHVQNk5pSDRoS1V1K2lpZWNzU2ZkUEZMOVRiZk9lZlBPRk1VT1RTaFNVKzgwSVZUL2xmUXUrMGhWN0lhYmk5CnpwaWRwSm1TMVlDeHZkdE9tZWRVSGhKUlNvdmpjTGZLM1gvOXpOeVR4Sk9NU1M2cGRjQVVEd1ZSRUl2dDZNbUwKS0NhdkxVRUNnWUVBOWI4cEtPdVRJc2oxSHFENXdNbGtKL2J2MXRPd3pVYXl1azZPOCs2eWlLeWxXanRzb1lTQwpwWUhVeGhCR1dwWUtpWGNjL0JoS0NiVGpkRXJBb3pPSGY3TjVxbGhIMURhTWF6OGI0eHU1WmdEdVdhUUVkUEdIClBUUWUwOXBJZHVndlR2aWI5QXpRK3lIV1dUZVUwR2w5STFtVHVmMjQ4RThOQ1daK256MzUvTUVDZ1lFQThLUlEKTWlEaVpvT1p5M0x3eUFUWE5uelRDOVVCQkFXaDFYaWMwUE8va2lkS1lTRDhFN2dnMXVQOU9EUW5YRjlVTXhtSgpCYnJvMGF0OVV4M3MyN0MyNFVxT0JjUXJ2eVBsWlJ0c2dZOVJIT1hLOVVqa0NOZXVYMXZweC9CMlM5U0RLUi9RClFuOXNaMU5zUWFCM0pGb2hkT3Nzd1lhUDNWSFBHdFpPMnJRQmRqMENnWUJMV3RMRU9YaGtzanAzcWVUcnVOVjkKYTdzZnBNb1NLQnVtQlhEUVcrRmpCNDJzbll3eCt2QVUwRHJ1Z1E4UnQvQ0ROb01zeWtYcHRBNExHdUQzS2xYaQpVcVo4RlpYdy9Na1NHY2Z6WEF6OXVrdGNNVzhzYk9PTFlQQVRCbHd5R2dCbnR0UWJnZEtUTDAwTERvQVRhRVYzCkVZQzdCNUl1SGc5aFVveUJSLy9nQVFLQmdCclZkOHZmTnQvUGxQckcybXF6ZjN3bjl6QytrOXBxOWx6amtqa0sKdFRZTEE1UkpKVkxkbVd2ZENJT1g3VHV6dGFQdEdRWjJqVGUwTThsczhOaWVvQVlIVmtiMlZScC9XamtvRWJWdwowYzZ6SVNxdzhoeTZVRXQ1NkZ2UFNLRzBGTndsSEFnT1JYeFFKU1k4U296WE1CdmxqWndXOFR2d3YzTnlxbUJnCjZqalJBb0dBU1BBd0M2V1hMNzZCeHRjQXBuVnd1Qm5pSk5INWlEcWhXTHZ3bHdONmxBZ0M5U3UyLzkrbTVxZDgKdjI0K1B6UC96VmtxU2NhWUx0OHhSdnZFTFBJZzBlZ3RCM0R3TS92KzZGcHlEYTF4MlljTGwxRXk4RXhXa3FjcwpPUmUxQkxxUkhyRjBLSjVKNVNIRURnVGNnY0tXZDBnU0NaS0tLODl6aTZ4N0xDZWRaZVE9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
---
# Source: telepresence-oss/templates/trafficManager-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
data:
  client.yaml: |
    dns:
      excludeSuffixes:
      - .com
      - .io
      - .net
      - .org
      - .ru
  namespace-selector.yaml: |
    matchExpressions:
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
      - kube-node-lease
  agent-state.yaml: |
    AgentStates: {}
---
# Source: telepresence-oss/templates/trafficManagerRbac/cluster-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: traffic-manager-default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
rules:
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - update 
- apiGroups:
  - ""
  resources:
  - nodes
  - services
  - namespaces
  - pods
  verbs:
  - list
  - get
  - watch
- apiGroups:
  - ""
  resources:
  - pods/eviction
  verbs:
  - create
- apiGroups:
  - ""
  resources:
  - pods/log
  verbs:
  - get
- apiGroups:
  - "apps"
  resources:
  - deployments
  - replicasets
  - statefulsets
  verbs:
  - get
  - list
  - watch
  - patch
- apiGroups:
    - "events.k8s.io"
  resources:
    - events
  verbs:
    - get
    - watch
- apiGroups:
    - "networking.k8s.io"
  resources:
    - servicecidrs
  verbs:
    - list
---
# Source: telepresence-oss/templates/trafficManagerRbac/cluster-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: traffic-manager-default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: traffic-manager-default
subjects:
- kind: ServiceAccount
  name: traffic-manager
  namespace: default
---
# Source: telepresence-oss/templates/trafficManagerRbac/namespace-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: traffic-manager
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
rules:
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - create
- apiGroups:
    - ""
  resources:
    - configmaps
  verbs:
    - get
    - list
    - watch
    - patch
    - update
  resourceNames:
    - traffic-manager
---
# Source: telepresence-oss/templates/trafficManagerRbac/webhook-secret.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: agent-injector-webhook-secret
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  resourceNames: [ mutator-webhook-tls ]
  verbs:
  - get
  - list
  - watch
---
# Source: telepresence-oss/templates/trafficManagerRbac/namespace-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: traffic-manager
subjects:
- kind: ServiceAccount
  name: traffic-manager
  namespace: default
---
# Source: telepresence-oss/templates/trafficManagerRbac/webhook-secret.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: agent-injector-webhook-secret
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: agent-injector-webhook-secret
subjects:
  - kind: ServiceAccount
    name: traffic-manager
    namespace: default
---
# Source: telepresence-oss/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
spec:
  type: ClusterIP
  clusterIP: None
  ports:
  - name: api
    port: 8081
    targetPort: api
  selector:
    app: traffic-manager
    telepresence: manager
---
# Source: telepresence-oss/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: agent-injector
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
spec:
  type: ClusterIP
  ports:
  - name: https
    port: 8443
    targetPort: https
  selector:
    app: traffic-manager
    telepresence: manager
---
# Source: telepresence-oss/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: traffic-manager
  namespace: default
  labels:
    
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      
      app: traffic-manager
      telepresence: manager
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1        # Allows creating one extra pod during the update
      maxUnavailable: 0  # Ensures no pods are terminated until new ones are ready
  template:
    metadata:
      labels:
        
        app: traffic-manager
        telepresence: manager
    spec:
      securityContext:
        
        null
      containers:
        - name: traffic-manager
          securityContext:
            
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 1000
          image: "ghcr.io/telepresenceio/tel2:2.26.0"
          imagePullPolicy: IfNotPresent
          env:
          - name: LOG_LEVEL
            value: info
          - name: REGISTRY
            value: "ghcr.io/telepresenceio"
          - name: SERVER_PORT
            value: "8081"
          - name: POD_CIDR_STRATEGY
            value: auto
          - name: MUTATOR_WEBHOOK_PORT
            value: "8443"
          - name: AGENT_INJECTOR_SECRET
            value: mutator-webhook-tls
          - name: GRPC_MAX_RECEIVE_SIZE
            value: 4Mi
          - name: CLIENT_CONNECTION_TTL
            value: 24h
          - name: ENABLED_WORKLOAD_KINDS
            value: >-
              Deployment
              StatefulSet
              ReplicaSet
          - name: INTERCEPT_ALLOW_GLOBAL
            value: "true"
          - name: INTERCEPT_INACTIVE_BLOCK_TIMEOUT
            value: 10m
          - name: AGENT_ARRIVAL_TIMEOUT
            value: "30s"
          - name: AGENT_INJECT_POLICY
            value: OnDemand
          - name: AGENT_INJECTOR_NAME
            value:  "agent-injector"
          - name: AGENT_INJECTOR_MUTATION_AWARE
            value: "true"
          - name: AGENT_PORT
            value: "9900"
          - name: AGENT_ENABLE_H2C_PROBING
            value: "true"
          - name: AGENT_CONSUMPTION_METRICS
            value: "true"
          - name: AGENT_MOUNT_POLICIES
            value: '{"/tmp":"Local"}'
          - name: AGENT_INIT_CONTAINER_ENABLED
            value: "true"
          - name: AGENT_IMAGE_PULL_POLICY
            value: IfNotPresent
          - name: MAX_NAMESPACE_SPECIFIC_WATCHERS
            value: "10"
          - name: MANAGER_NAMESPACE
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
          - name: POD_IP
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: status.podIP
          - name: CLIENT_DNS_EXCLUDE_SUFFIXES
            value: ".com .io .net .org .ru"
          ports:
          - name: api
            containerPort: 8081
          - name: https
            containerPort: 8443
          startupProbe:
            grpc:
              port: 8081
            periodSeconds: 2
            failureThreshold: 5
      serviceAccountName: traffic-manager
---
# Source: telepresence-oss/templates/agentInjectorWebhook.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: agent-injector-webhook-default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKRENDQWd5Z0F3SUJBZ0lSQU0vdVFRWjlka2U4K3lSaHBRS3VEOHN3RFFZSktvWklodmNOQVFFTEJRQXcKSERFYU1CZ0dBMVVFQXhNUllXZGxiblF0YVc1cVpXTjBiM0l0WTJFd0hoY05Nall3TVRJME1UZzBOREExV2hjTgpNamN3TVRJME1UZzBOREExV2pBY01Sb3dHQVlEVlFRREV4RmhaMlZ1ZEMxcGJtcGxZM1J2Y2kxallUQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPRDhvcEl1SzQ5KzNjRkk3NWlHaExueGJGcmEKR3VhaENqaTgrdTBWenZzS052T3BlNDB5OGtxeEFORVdGYlFzTSswckoydGhDeXhxY0NQTHNYdmxyMStnSDJEVwpMVXIrVVlDM3JtcHJ4LzN6Snh2Yk1mSzdnTGN0U0RHeHJ4bHFmTEhJZjhSQzZqNVJtMkdydUhhNUVYVHFvQXdCCmNSVmc3ZGV6RDA3Z0M0c3FQcXZGcm9FeWw2MG1sTjQ3ZUdKN0ZlQ0hlVlhMd010R1dDOFZZZERSZElZZXFXdm4KSG5ybzFrUEVBK1VkNUp1YzVKSnVLMjZSOHd6UGs4UGtEQnRHb2tJUlFvRlhFYmVkSDdwUjZudHJyczNQS3FhVgp2aGxhT1k2anh2Z0ZOUzFsU0g0eHJEQ0ZUQ1FkYVRBaUxENWdFLzFlR2hrSXMvOUtFVEZYa2NjZDVoMENBd0VBCkFhTmhNRjh3RGdZRFZSMFBBUUgvQkFRREFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRV0JCVEdrZ1JIZVpvTCtYb0ZwNGZBVUpNMgpPeTd0SkRBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQWZ2VVkrOG5FRlQ0aHdPOCtnUjQ0bXBSdStGTDdObmlWCkM3dFMzanJRc3ByYWxiNkVRUXltcmE0YzllOGR5ZTJ0VVl4dHlNY3UydVdSZ0s0M1IxeG4wUlBCNG9QVUdMLzIKU1JOSk9uWWtzWU9FZzJpVHIxenFIK0h4b3ZwdXBwMlZFNnZOR1Y0S2I1K0Z5LzdnQkpIQlg0SFd1L1NLZm5mRAorcjBXNjhmaG9rcUVsNThqOUdDTzFEeG1ISjR3UHovdE1WK0lEcVFDNHNid3JRYXBCOUQydUwrRStWSElpbmJUCkZneFdqeEZmU2xuaHl0Y2MvT1EwYzRtdHFwQyt2YlNoaGJITlY5ZWl3WmVqYkl1bmllcjg0VXlNZkgycVl1SGgKVk5aM1hKcnRyRVdCM0FlbnlXb1NjaCtUclZKcHUyTjBsWncyRXZuSENabUN0YmhJbWRLTUV3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    service:
      name: agent-injector
      namespace: default
      path: /traffic-agent
      port: 8443
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    - DELETE
    resources:
    - pods
    scope: '*'
  failurePolicy: Ignore
  reinvocationPolicy: IfNeeded
  name: agent-injector-default.telepresence.io
  sideEffects: None
  timeoutSeconds: 5
  namespaceSelector:
    matchExpressions:
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
      - kube-node-lease
---
# Source: telepresence-oss/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "traffic-manager-test-connection"
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.26.0
    app.kubernetes.io/version: "2.26.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
    - name: wget
      image: "docker.io/busybox:latest"
      command: ['wget']
      args: ['traffic-manager:8081']
  restartPolicy: Never
---
# Source: telepresence-oss/templates/pre-delete-hook.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: uninstall-agents
  namespace: default
  labels:
    app.kubernetes.io/managed-by: "Helm"
    app.kubernetes.io/instance: "telepresence-traffic-manager"
    app.kubernetes.io/version: 2.26.0
    helm.sh/chart: "telepresence-oss-2.26.0"
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-weight": "-5"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  backoffLimit: 1
  template:
    metadata:
      name: uninstall-agents
      labels:
        app.kubernetes.io/managed-by: "Helm"
        app.kubernetes.io/instance: "telepresence-traffic-manager"
        helm.sh/chart: "telepresence-oss-2.26.0"
    spec:
      securityContext:
        null
      restartPolicy: Never
      containers:
        - name: uninstall-agents
          securityContext:
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 1000
          image: "docker.io/curlimages/curl:8.1.1"
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: secret-volume
              mountPath: /secret
          env:
            - name: CURL_CA_BUNDLE
              value: /secret/ca.crt
          resources:
            null
          command:
            - sh
            - -c
          args:
            - 'curl --fail --connect-timeout 5 --max-time 60 --request DELETE https://agent-injector.default:8443/uninstall || exit 0'
      volumes:
        - name: secret-volume
          secret:
            secretName: mutator-webhook-tls
