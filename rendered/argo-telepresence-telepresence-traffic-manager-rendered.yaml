---
# Source: telepresence-oss/templates/trafficManagerRbac/service-account.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
---
# Source: telepresence-oss/templates/agentInjectorWebhook.yaml
apiVersion: v1
kind: Secret
metadata:
  name: mutator-webhook-tls
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKRENDQWd5Z0F3SUJBZ0lSQVBWeXZKTzdUYjRIU1FsRGRGYzNZeVF3RFFZSktvWklodmNOQVFFTEJRQXcKSERFYU1CZ0dBMVVFQXhNUllXZGxiblF0YVc1cVpXTjBiM0l0WTJFd0hoY05Nall3TVRJeE1qRXhPREUwV2hjTgpNamN3TVRJeE1qRXhPREUwV2pBY01Sb3dHQVlEVlFRREV4RmhaMlZ1ZEMxcGJtcGxZM1J2Y2kxallUQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFLb29UdlAxaTVFeTUvckgvbWxXYm52R1Zva0YKb3NOYWZuZlpWN1dwSHFEMlJXeCtKM25McXNGUW0vQ2JQMUtyY25PM1RlRHNHTnZtM0VJVDROd2hzSmlkMDFRNwpDbkY5ZEg0bkpRNkZCZVc3QUpoZ01PdFlsSVY1K2plcDB1NENXV2JtS0l3ZUptVENLZGh0cjZTaWwxeG5pYm5TCmUxNjdpZEluYTRqWVlGVThHVlFXWEdiNVozOFpGQWlucWdMelVSSnBQWGtXWjk4U0ZwTzc2SE9oaW5pWlZDcnAKOTgvRkh4SGhyUUJBbzN0VG9JeUdSTXdRWElHUlIxdkQ2dlBXeDBFUFNvVGladE1VVHhJTC9QcnF0bTdpb3hjQwpkSVB6UXAvNG04VFY1amtvdy91bmduTzBoV1VqSFZORk9Eb3R1QU5EbG55dVFlazl1Z2lWSmgrbW15OENBd0VBCkFhTmhNRjh3RGdZRFZSMFBBUUgvQkFRREFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRV0JCUm4wQlRBNkJWejB0U2tJUW4xc3dkNApSUmhzVURBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQW1TL2hZMysyYjlOcEdWQmttbkc4Uy9kdmRyNnlUcFZWClNiK3FhRW9Jb3hxM0lEaDV3eXFSdzJnckZXSUZ6bUl5d1VtUzdnb0RaK2dkaTVjOGZyNG5PZWxEc1NGLzJxbDgKTFIvejF5aXUvYXgyR0hlQnVvazZlalpwcGlmdWo2TkZyN1kveVBMZXl5MWMrOWthQStEVXg2Y2V2RW11VjNEaQp6RGMvMjQxTWxOS0QrLy9FUUxhM1BYTklQLy9EWTI5YmRKODBnTUlqUVV1VEFyMmcwVkpDcDZBbC90R0tJdEZOCndjUlNjWGJvOHhuUGdpZW5naXdCZTdRdHdDQkxqUm10bWY5OFhURlVFNGUzRmM5Z0NybFhTcFk2QWpkOEtLVkoKdmNvc09xMjQwakVUMUxCMU1oNVZVekllRDNac0dWZU96UXJvSjkvemNDQXl3TXpIU1NmYUpRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURZVENDQWttZ0F3SUJBZ0lSQUpkam03ZmozYlJ5WEp1M3pBM3Q1dFV3RFFZSktvWklodmNOQVFFTEJRQXcKSERFYU1CZ0dBMVVFQXhNUllXZGxiblF0YVc1cVpXTjBiM0l0WTJFd0hoY05Nall3TVRJeE1qRXhPREUwV2hjTgpNamN3TVRJeE1qRXhPREUwV2pBWk1SY3dGUVlEVlFRREV3NWhaMlZ1ZEMxcGJtcGxZM1J2Y2pDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU1sc0VmY1A4K3dGckVrRGhsOTZWZlNFa0ZKR202RTgKZXQ5NFhNbHg2OHptNzZhOVpMNU1wZDI1WFJ0b2cwVTA3by96eWJZQ21jcWlQU1J1WWpwV3FFMXpoQ1dkQ0hROAorekRtVVVmdVNBVWM4N0tNWm1hNm5mZzdCRFhCVExiVTdzR001QVE1OWhDVFpERmJDZXZ0NG9xdzlSL0o2eUZ3CjQyak9Gb09qZWNZeTdOcnRDaS9UYUxwNk44dVBYRmUyNWdGRjVvVWZyZEtDU1lUSkxjZ0Y0WE5QTGM3b2kxcG0KRUkrRDlyZjZOcWZ2SE55ZGtucDZkOU5zYSt4VlVSR2tXVW1acnl3cjNzMHJqRzRoK3hpUVNNTnhmUmNuTVVEKwplYTJpMlROeFB3SGs4U0hDZ1FxU3NnM1RoVEQ5TWxFQkJRSFZKcmZFckV4RHpMUUpRR2NGMmEwQ0F3RUFBYU9CCm9EQ0JuVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0VHQ0NzR0FRVUYKQndNQ01Bd0dBMVVkRXdFQi93UUNNQUF3SHdZRFZSMGpCQmd3Rm9BVVo5QVV3T2dWYzlMVXBDRUo5Yk1IZUVVWQpiRkF3UFFZRFZSMFJCRFl3TklJV1lXZGxiblF0YVc1cVpXTjBiM0l1WkdWbVlYVnNkSUlhWVdkbGJuUXRhVzVxClpXTjBiM0l1WkdWbVlYVnNkQzV6ZG1Nd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFJdDYrWnlQekJSY1JCU3gKdjBqdzN5dER2T2JDaE45UVJsSjYzUWw1Um9WdFBCV1kvY3ZEYU52S3czL1FBQnBnVlFrWjJQemc4TEpKeUhyWgpxRTZqRjZEeTdFL2xjSlZvWmJscmhlazNITkl4SU00bGNxeHRMVWZ0R3dlUmtQdGZyOURzS09YZVBNc1gwL3JPCmxOSmxKU3hHVWZJWmoxV3lvTkhsOHh5ZTQyVFhKWmFRY1A4RmxQdklZdFpWT0NncXp4QXlST2EwcW1uc0c5OUMKeU9MQ1ZuanE0akxSN2UwWE5sYTh5ZEhqU0lSQlhWRlNTNjMyaE1obWgvYWlidW11bzl2d2g2YWtBWnVkUHNaMApBMlVscVg5bzN0MzVVUmFnbWtjTTBQeU1qUUpiRTFrbmJrd2JtakNJalgwMThnRXptWmJoWEdzdnlxMjVFM1ZvCmtzMVVSZHM9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBeVd3Ujl3L3o3QVdzU1FPR1gzcFY5SVNRVWthYm9UeDYzM2hjeVhIcnpPYnZwcjFrCnZreWwzYmxkRzJpRFJUVHVqL1BKdGdLWnlxSTlKRzVpT2xhb1RYT0VKWjBJZER6N01PWlJSKzVJQlJ6enNveG0KWnJxZCtEc0VOY0ZNdHRUdXdZemtCRG4yRUpOa01Wc0o2KzNpaXJEMUg4bnJJWERqYU00V2c2TjV4akxzMnUwSwpMOU5vdW5vM3k0OWNWN2JtQVVYbWhSK3Qwb0pKaE1rdHlBWGhjMDh0enVpTFdtWVFqNFAydC9vMnArOGMzSjJTCmVucDMwMnhyN0ZWUkVhUlpTWm12TEN2ZXpTdU1iaUg3R0pCSXczRjlGeWN4UVA1NXJhTFpNM0UvQWVUeEljS0IKQ3BLeURkT0ZNUDB5VVFFRkFkVW10OFNzVEVQTXRBbEFad1haclFJREFRQUJBb0lCQUFhMUxTSDdxNFZjS1FFagpkMm1ka3RnNlErNGhnTlJOUmRCRVcxNndCd2pEVmc3STl0NXBnZ3FRdmp1SDd2c3lpSkZOcnBWN243Q0NWNlByCmN5VDdOczZoZnJDYitxaVlVVXN2R0Z6YllCV2ZnYlFiL2RzRTh2Yk56RldYOHR5UjJjT2pWQUthQllwR3hrcm8KZTd1YUovV3piKzVYbEplQUFXcS9sanRiQ2RhaVUxOXNPY3JSbEFEV0Rkd3c2RWNQdmNXdnJSYkVHejhTUFhkWApIc3Y2NWo2MWl5N3V0WUQ3OFJya0xuY2VpSGhsKzM4L2laakdZczdCSWkyUEFSc010b1podloyN1VESDVuYWZHCnNKU2FnWklwKzVDVGI4OHF2NHJPbnhoeUw1RTZUODAreTJwekUxL2dhM3RmaUVwOFJ4NzFDdk1mcUpSOWtHMW8KNWJ6L1AyY0NnWUVBMWgxaDNxNzFZRGZIM1VuY0ZMMWpDaFRENlE3bVZpaE5vOVI3WFFKM3IvTTVYaThiK3hqWApyNlhLVjJMenZlTUpNQU53NzM1ZVlsTDBTTHgrQ2ROczlrV1FGVUpFbVNTc1hPNEdIQS9kZEZpbzdlaTkwcE1yCnRib1FzdkNISTF4ZUM0U1k4RmFFdjdnblpuMnBDK1NoOWsyUy9jL2hTNWF3RTNXU2pFc0ZHT3NDZ1lFQThOTU8KVjA3NUNFazI3elhIS2toR3ZjbUFNc2VwNHh3YU1VTW1OamkzdjZheldtT1VjY3VBNFFWQmxnZkpIWFl5bDBEYwpUbjZhc2pHWUc5VlRQZHBjQ0lLZ3pBQ3EwSEhxMlQzTHR6eHFqZlhrR09GMi9WNkdKV3NpdXFJK1lsUDJGemxGCjM1MkkxZVZUaE5UZnRzRTZOcnUvQ0hRcGpsSDVxZitjKzhvL3NjY0NnWUVBazdidmx5NUMwRitMUGlvL2IvdDgKUVM4MFBTdnZVbzg1aVFZRkdaU2pON3JuNEFkR0dZUDVBUSt5dVhqbHlTSEJhK05qM1lYajNaZDNPbHIzNVJWOApmYVplRVp5SE1OUHhLYWQ0aFpHWWFUVGxUa1NiK0pOWnUyU2pNcC9ueTBobEJUTTBROUtjZ0p1dWF2SFVWd1VqCmk0WFhHODEzazZ0Z3kvdjMzMXUrSjRNQ2dZRUFscjJsVm1VcVlGTmp2V3ZPRk50VTNHc0tnYjZVeW9IR3ExczYKeWVuS3FuM3YrZjRtNXV2WTZnRGVRc2p3ekM0MkVKTWEwMDlRQ1lZZGpoNkRrazNpR2JtYWFOZHFGRHVhSXcwWgpQTUxtZDZHWWV6SjF4cmFxQlRZQWNRNHBPbWNQdlEydWZRQWdyTEoxQ3Nvc2xqcHc4OTJrLytlbU0xMkFoelptCnp2eVR6ZlVDZ1lBVDZkWm1zdDVoeFM2VjdqRDNQTEExcGIvaDNmNGJwRFdXdjhkZVJWVkZzR1M2a3h5dloySWEKbFVJMUhlK2lDVGRhbHBvNWpaL3VUMXVNOXlkZnpVNkc5YWVndlMrU2ZUNDFINmlhdU5peWpQWVYxWUlxeEVLYwo0aUJ0NXVOOUo1MzNNbVBucGFtV3dyVjJycm1oYzR4REVBUGVzMElNRDk2OThpTXNHSEkwK1E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
# Source: telepresence-oss/templates/trafficManager-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
data:
  client.yaml: |
    dns:
      excludeSuffixes:
      - .com
      - .io
      - .net
      - .org
      - .ru
  namespace-selector.yaml: |
    matchExpressions:
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
      - kube-node-lease
  agent-state.yaml: |
    AgentStates: {}
---
# Source: telepresence-oss/templates/trafficManagerRbac/cluster-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: traffic-manager-default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
rules:
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - update 
- apiGroups:
  - ""
  resources:
  - nodes
  - services
  - namespaces
  - pods
  verbs:
  - list
  - get
  - watch
- apiGroups:
  - ""
  resources:
  - pods/eviction
  verbs:
  - create
- apiGroups:
  - ""
  resources:
  - pods/log
  verbs:
  - get
- apiGroups:
  - "apps"
  resources:
  - deployments
  - replicasets
  - statefulsets
  verbs:
  - get
  - list
  - watch
  - patch
- apiGroups:
    - "events.k8s.io"
  resources:
    - events
  verbs:
    - get
    - watch
- apiGroups:
    - "networking.k8s.io"
  resources:
    - servicecidrs
  verbs:
    - list
---
# Source: telepresence-oss/templates/trafficManagerRbac/cluster-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: traffic-manager-default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: traffic-manager-default
subjects:
- kind: ServiceAccount
  name: traffic-manager
  namespace: default
---
# Source: telepresence-oss/templates/trafficManagerRbac/namespace-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: traffic-manager
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
rules:
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - create
- apiGroups:
    - ""
  resources:
    - configmaps
  verbs:
    - get
    - list
    - watch
    - patch
  resourceNames:
    - traffic-manager
---
# Source: telepresence-oss/templates/trafficManagerRbac/webhook-secret.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: agent-injector-webhook-secret
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  resourceNames: [ mutator-webhook-tls ]
  verbs:
  - get
  - list
  - watch
---
# Source: telepresence-oss/templates/trafficManagerRbac/namespace-scope.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: traffic-manager
subjects:
- kind: ServiceAccount
  name: traffic-manager
  namespace: default
---
# Source: telepresence-oss/templates/trafficManagerRbac/webhook-secret.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: agent-injector-webhook-secret
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: agent-injector-webhook-secret
subjects:
  - kind: ServiceAccount
    name: traffic-manager
    namespace: default
---
# Source: telepresence-oss/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
spec:
  type: ClusterIP
  clusterIP: None
  ports:
  - name: api
    port: 8081
    targetPort: api
  selector:
    app: traffic-manager
    telepresence: manager
---
# Source: telepresence-oss/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: agent-injector
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
spec:
  type: ClusterIP
  ports:
  - name: https
    port: 8443
    targetPort: https
  selector:
    app: traffic-manager
    telepresence: manager
---
# Source: telepresence-oss/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: traffic-manager
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app: traffic-manager
      telepresence: manager
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1        # Allows creating one extra pod during the update
      maxUnavailable: 0  # Ensures no pods are terminated until new ones are ready
  template:
    metadata:
      labels:
        app: traffic-manager
        telepresence: manager
    spec:
      securityContext:
        null
      containers:
        - name: traffic-manager
          securityContext:
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 1000
          image: "ghcr.io/telepresenceio/tel2:2.25.2"
          imagePullPolicy: IfNotPresent
          env:
          - name: LOG_LEVEL
            value: info
          - name: REGISTRY
            value: "ghcr.io/telepresenceio"
          - name: SERVER_PORT
            value: "8081"
          - name: POD_CIDR_STRATEGY
            value: auto
          - name: MUTATOR_WEBHOOK_PORT
            value: "8443"
          - name: AGENT_INJECTOR_SECRET
            value: mutator-webhook-tls
          - name: GRPC_MAX_RECEIVE_SIZE
            value: 4Mi
          - name: CLIENT_CONNECTION_TTL
            value: 24h
          - name: ENABLED_WORKLOAD_KINDS
            value: >-
              Deployment
              StatefulSet
              ReplicaSet
          - name: AGENT_ARRIVAL_TIMEOUT
            value: "30s"
          - name: AGENT_INJECT_POLICY
            value: OnDemand
          - name: AGENT_INJECTOR_NAME
            value:  "agent-injector"
          - name: AGENT_PORT
            value: "9900"
          - name: AGENT_MOUNT_POLICIES
            value: '{"/tmp":"Local"}'
          - name: AGENT_INIT_CONTAINER_ENABLED
            value: "true"
          - name: AGENT_IMAGE_PULL_POLICY
            value: IfNotPresent
          - name: MAX_NAMESPACE_SPECIFIC_WATCHERS
            value: "10"
          - name: MANAGER_NAMESPACE
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
          - name: POD_IP
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: status.podIP
          - name: CLIENT_DNS_EXCLUDE_SUFFIXES
            value: ".com .io .net .org .ru"
          ports:
          - name: api
            containerPort: 8081
          - name: https
            containerPort: 8443
      serviceAccount: traffic-manager
      serviceAccountName: traffic-manager
---
# Source: telepresence-oss/templates/agentInjectorWebhook.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: agent-injector-webhook-default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKRENDQWd5Z0F3SUJBZ0lSQVBWeXZKTzdUYjRIU1FsRGRGYzNZeVF3RFFZSktvWklodmNOQVFFTEJRQXcKSERFYU1CZ0dBMVVFQXhNUllXZGxiblF0YVc1cVpXTjBiM0l0WTJFd0hoY05Nall3TVRJeE1qRXhPREUwV2hjTgpNamN3TVRJeE1qRXhPREUwV2pBY01Sb3dHQVlEVlFRREV4RmhaMlZ1ZEMxcGJtcGxZM1J2Y2kxallUQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFLb29UdlAxaTVFeTUvckgvbWxXYm52R1Zva0YKb3NOYWZuZlpWN1dwSHFEMlJXeCtKM25McXNGUW0vQ2JQMUtyY25PM1RlRHNHTnZtM0VJVDROd2hzSmlkMDFRNwpDbkY5ZEg0bkpRNkZCZVc3QUpoZ01PdFlsSVY1K2plcDB1NENXV2JtS0l3ZUptVENLZGh0cjZTaWwxeG5pYm5TCmUxNjdpZEluYTRqWVlGVThHVlFXWEdiNVozOFpGQWlucWdMelVSSnBQWGtXWjk4U0ZwTzc2SE9oaW5pWlZDcnAKOTgvRkh4SGhyUUJBbzN0VG9JeUdSTXdRWElHUlIxdkQ2dlBXeDBFUFNvVGladE1VVHhJTC9QcnF0bTdpb3hjQwpkSVB6UXAvNG04VFY1amtvdy91bmduTzBoV1VqSFZORk9Eb3R1QU5EbG55dVFlazl1Z2lWSmgrbW15OENBd0VBCkFhTmhNRjh3RGdZRFZSMFBBUUgvQkFRREFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRV0JCUm4wQlRBNkJWejB0U2tJUW4xc3dkNApSUmhzVURBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQW1TL2hZMysyYjlOcEdWQmttbkc4Uy9kdmRyNnlUcFZWClNiK3FhRW9Jb3hxM0lEaDV3eXFSdzJnckZXSUZ6bUl5d1VtUzdnb0RaK2dkaTVjOGZyNG5PZWxEc1NGLzJxbDgKTFIvejF5aXUvYXgyR0hlQnVvazZlalpwcGlmdWo2TkZyN1kveVBMZXl5MWMrOWthQStEVXg2Y2V2RW11VjNEaQp6RGMvMjQxTWxOS0QrLy9FUUxhM1BYTklQLy9EWTI5YmRKODBnTUlqUVV1VEFyMmcwVkpDcDZBbC90R0tJdEZOCndjUlNjWGJvOHhuUGdpZW5naXdCZTdRdHdDQkxqUm10bWY5OFhURlVFNGUzRmM5Z0NybFhTcFk2QWpkOEtLVkoKdmNvc09xMjQwakVUMUxCMU1oNVZVekllRDNac0dWZU96UXJvSjkvemNDQXl3TXpIU1NmYUpRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    service:
      name: agent-injector
      namespace: default
      path: /traffic-agent
      port: 8443
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    - DELETE
    resources:
    - pods
    scope: '*'
  failurePolicy: Ignore
  reinvocationPolicy: IfNeeded
  name: agent-injector-default.telepresence.io
  sideEffects: None
  timeoutSeconds: 5
  namespaceSelector:
    matchExpressions:
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
      - kube-node-lease
---
# Source: telepresence-oss/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "traffic-manager-test-connection"
  namespace: default
  labels:
    app: traffic-manager
    telepresence: manager
    helm.sh/chart: telepresence-oss-2.25.2
    app.kubernetes.io/version: "2.25.2"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/created-by: Helm
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
    - name: wget
      image: "docker.io/busybox:latest"
      command: ['wget']
      args: ['traffic-manager:8081']
  restartPolicy: Never
---
# Source: telepresence-oss/templates/pre-delete-hook.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: uninstall-agents
  namespace: default
  labels:
    app.kubernetes.io/managed-by: "Helm"
    app.kubernetes.io/instance: "telepresence-traffic-manager"
    app.kubernetes.io/version: 2.25.2
    helm.sh/chart: "telepresence-oss-2.25.2"
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-weight": "-5"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  backoffLimit: 1
  template:
    metadata:
      name: uninstall-agents
      labels:
        app.kubernetes.io/managed-by: "Helm"
        app.kubernetes.io/instance: "telepresence-traffic-manager"
        helm.sh/chart: "telepresence-oss-2.25.2"
    spec:
      securityContext:
        null
      restartPolicy: Never
      containers:
        - name: uninstall-agents
          securityContext:
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 1000
          image: "docker.io/curlimages/curl:8.1.1"
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: secret-volume
              mountPath: /secret
          env:
            - name: CURL_CA_BUNDLE
              value: /secret/ca.crt
          resources:
            null
          command:
            - sh
            - -c
          args:
            - 'curl --fail --connect-timeout 5 --max-time 60 --request DELETE https://agent-injector.default:8443/uninstall || exit 0'
      volumes:
        - name: secret-volume
          secret:
            secretName: mutator-webhook-tls
