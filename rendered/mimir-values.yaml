nginx:
  enabled: false
global:
  # dnsService: coredns
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: mimir-s3-storage-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: mimir-s3-storage-creds
          key: AWS_SECRET_ACCESS_KEY
mimir:
  structuredConfig:
    common:
      storage:
        # backend: azure #s3, gcs, azure, swift, filesystem.
        backend: s3
        s3:
          bucket_name: hegerdes-monitoring
          region: weur
          endpoint: f8dcb6c50cc8b86dcf6953a50c3bf736.r2.cloudflarestorage.com
          access_key_id: "${AWS_ACCESS_KEY_ID}"
          secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
          # http:
          #   insecure_skip_verify: true
        # azure:
        #   container_name: mimir-data
        #   account_key: "${AZURE_STORAGE_ACCOUNT_KEY}"
        #   account_name: hegerdesdevblobs
        #   endpoint_suffix: blob.core.windows.net
    blocks_storage:
      # s3:
      #   bucket_name: hegerdes-mimir-blocks
      # azure:
      #   container_name: mimir-blocks
      storage_prefix: k8smimir4blocks
    alertmanager_storage:
      # s3:
      #   bucket_name: hegerdes-mimir-alertmanager
      # azure:
      #   container_name: mimir-alertmanager
      storage_prefix: k8smimir4alerts
    ruler_storage:
      # s3:
      #   bucket_name: hegerdes-mimir-ruler
      # azure:
      #   container_name: mimir-ruler
      storage_prefix: k8smimir4ruler
    ruler:
      external_url: https://grafana.k8s.henrikgerdes.me
    limits:
      max_global_series_per_user: 2000000
      ingestion_rate: 100000 # default of 10000 * 10
      ingestion_burst_size: 2000000 # default of 200000 * 10
      ruler_max_rules_per_rule_group: 40
alertmanager:
  enabled: true
  replicas: 1
  # userConfig:
  #   alertmanager_config: |

  persistentVolume:
    # If false, use emptyDir
    enabled: true
    annotations: {}
    accessModes: [ReadWriteOnce]
    size: 1Gi
    enableRetentionPolicy: false
    whenDeleted: Retain
    whenScaled: Retain
ingester:
  replicas: 3
  statefulSet:
    enabled: true
  persistentVolume:
    enabled: true
    annotations: {}
    accessModes: [ReadWriteOnce]
    size: 2Gi
    enableRetentionPolicy: false
    whenDeleted: Retain
    whenScaled: Retain
    # storageClass: "-"
compactor:
  replicas: 1
  persistentVolume:
    enabled: true
    annotations: {}
    accessModes: [ReadWriteOnce]
    size: 2Gi
    enableRetentionPolicy: false
    whenDeleted: Retain
    whenScaled: Retain
memcachedExporter:
  enabled: false
# -- Setting for the Grafana Rollout Operator https://github.com/grafana/helm-charts/tree/main/charts/rollout-operator
rollout_operator:
  enabled: false
minio:
  enabled: false
# -- A reverse proxy deployment that is meant to receive traffic for Mimir or GEM.
# When enterprise.enabled is true the GEM gateway is deployed. Otherwise, it is an nginx.
# Options except those under gateway.nginx apply to both versions - nginx and GEM gateway.
gateway:
  enabled: true
  enabledNonEnterprise: true
  replicas: 1
  ingress:
    enabled: false
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod-nginx
      # # Basic auth for now
      # nginx.ingress.kubernetes.io/auth-type: "basic"
      # nginx.ingress.kubernetes.io/auth-secret: "monitoring-auth"
    hosts:
      # -- Passed through the `tpl` function to allow templating.
      - host: mimir.k8s.henrikgerdes.me
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: mimir-tls
        hosts:
          - mimir.k8s.henrikgerdes.me
extraObjects:
  - apiVersion: external-secrets.io/v1
    kind: ExternalSecret
    metadata:
      name: mimir-s3-storage-creds
    spec:
      refreshInterval: 1h
      secretStoreRef:
        kind: ClusterSecretStore
        name: azure-store
      target:
        name: mimir-s3-storage-creds
        creationPolicy: Owner
      data:
        - secretKey: AWS_ACCESS_KEY_ID
          remoteRef:
            key: cloudflare-r2-monitoring-key-id
            decodingStrategy: None # can be None, Base64, Base64URL or Auto
        - secretKey: AWS_SECRET_ACCESS_KEY
          remoteRef:
            key: cloudflare-r2-monitoring-secret-key
            decodingStrategy: None # can be None, Base64, Base64URL or Auto
